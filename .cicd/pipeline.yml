steps:

  - wait

  - label: "Create Docker Image 'eosio/contracts-builder'"
    command: "./.cicd/contracts-docker.sh"
    agents:
      queue: "automation-standard-builder-fleet"
    timeout: ${TIMEOUT:-10}
    skip: $SKIP_UBUNTU_18

  - wait

  - label: ":ubuntu: Ubuntu 18.04 - Build"
    command:
      - ./.cicd/build.sh
      - "tar -pczf build.tar.gz build && buildkite-agent artifact upload build.tar.gz"
    agents:
      queue: "automation-eos-builder-fleet"
    timeout: ${TIMEOUT:-10}
    skip: $SKIP_UBUNTU_18

  - wait

  - label: ":ubuntu: Ubuntu 18.04 - Test"
    command:
      - "buildkite-agent artifact download build.tar.gz . --step ':ubuntu: Ubuntu 18.04 - Build' && tar -xzf build.tar.gz"
      - bash ./.cicd/test.sh
    agents:
      queue: "automation-eos-builder-fleet"
    timeout: ${TIMEOUT:-10}
    skip: $SKIP_UBUNTU_18